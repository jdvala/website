<h1 id="removing-data-set-discrepancies">Removing Data Set Discrepancies</h1>

<p>There were a lot of discrepancies in the dataset I created in the <a href="https://jdvala.github.io/blog.io/thesis/2018/05/15/Data-Set-Creation.html">last step</a> and I have detailed it in the most recent <a href="https://jdvala.github.io/blog.io/thesis/2018/05/16/Data-Discrepancies.html">post</a>. The most efficent way of removing those long sentences, and making them suitable for learning was making it of a fixed length.</p>

<p>I have used a technique called <a href="https://en.wikipedia.org/wiki/Sliding_window_protocol">Sliding Window Protocol</a> here is the brief example of how this is used here for breaking long sentences into smaller ones of fixed size.</p>

<p><img src="/images/sliding_window.png" /></p>

<p>All the code will be the same from the <a href="https://jdvala.github.io/blog.io/thesis/2018/05/15/Data-Set-Creation.html">last step</a> but there will be a small change.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First lets create list of topics
</span><span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s">'/home/jay/GITHUB/Data_Thesis/Ready/'</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make a dictionary to hold the labels and corresponding category
</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</code></pre></div></div>

<p>Now its time to write the sliding window function. Here the function <code class="highlighter-rouge">slidingWindow</code> takes three arguments, first one is the <code class="highlighter-rouge">sequence</code> that we desire to break, <code class="highlighter-rouge">winSize</code> is the desired window size(how long the sequence should be) and <code class="highlighter-rouge">step</code> is the number of words after the first word to the next sequence. The image above helps in clearing it out.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">slidingWindow</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span><span class="n">winSize</span><span class="p">,</span><span class="n">step</span><span class="p">):</span>
    <span class="s">"""Returns a generator that will iterate through
    the defined chunks of input sequence. Input sequence
    must be sliceable."""</span>

    <span class="c1"># Pre-compute number of chunks to emit
</span>    <span class="n">numOfChunks</span> <span class="o">=</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span><span class="o">-</span><span class="n">winSize</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="c1"># Do the work
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">numOfChunks</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">,</span><span class="n">step</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">winSize</span><span class="p">]</span>
</code></pre></div></div>

<p><strong>NOTE:</strong> *Here I have rounded off the <code class="highlighter-rouge">numOfChunks</code> parameter. It is because the formula to calculate it would result into floating point numbers which can not be used in the range function. For example, if the length of sequence is 41 and <code class="highlighter-rouge">winSize</code> is 20 and <code class="highlighter-rouge">step</code> is 20 then the <code class="highlighter-rouge">numOfChunks</code> will be <code class="highlighter-rouge">((41-20)/20)+1 = 2.05</code> *</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Lets go through the files and take file name, dir name, and subdir name
</span>
<span class="n">sent</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to store the sentence
</span><span class="n">label</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List to store the label(alpha)
</span><span class="n">label_num</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to store numerical label
</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s">'/home/jay/GITHUB/Data_Thesis/Ready/'</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.txt'</span><span class="p">):</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>  <span class="c1">## we prefere to get the sentences in the list form so that it is easy for us to label it
</span>             
                
                <span class="c1"># Store every sentence with its corresponding labels in a list
</span>                <span class="c1"># Get the label
</span>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic</span><span class="p">):</span>      <span class="c1"># If the dir is equal to any value in the labels dict then
</span>                        <span class="n">label_</span> <span class="o">=</span> <span class="n">key</span>
                        
    
                           
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cont</span><span class="p">:</span>
                    <span class="c1"># Checks 
</span>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;=</span><span class="mi">5</span><span class="p">:</span>   <span class="c1"># If the sentence is less than 5 words, just ignore them
</span>                        <span class="k">pass</span> 
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">5</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">&lt;=</span><span class="mi">20</span><span class="p">:</span>  <span class="c1"># If its betweenn 5 and 20 just add them to dataset
</span>                        <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
                        <span class="n">label_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                        <span class="c1"># break the lines into 20 words each
</span>                        <span class="c1"># for this I will use sliding window
</span>                        <span class="n">slides</span> <span class="o">=</span> <span class="n">slidingWindow</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">slide</span> <span class="ow">in</span> <span class="n">slides</span><span class="p">:</span>
                            <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slide</span><span class="p">)</span>
                            <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
                            <span class="n">label_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_</span><span class="p">)</span>

</code></pre></div></div>

<p>Also there is a change in the way I am selecting the lines to be added in dataset. If the length of the line is smaller than or equal to 5 then I will ignore the lines, <strong>but I will not do it after the silding window, as there may be slides which have less than 5 words, I was removing it previously because it did not convey any meaning but I know for sure that after the silding window the lines will be from a bigger chunk of text which had importance so any small line from it will also be important.</strong></p>
